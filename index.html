<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="style.css" />
    <link
      rel="stylesheet"
      href="//ajax.googleapis.com/ajax/libs/dojo/1.10.4/dijit/themes/claro/claro.css"
    />
    <title>Widget Training</title>
  </head>

  <body class="claro">
    <div id="container"></div>

    <div id="under" class="under-overlay">
      <button id="btn" class="under-btn">See the beer!</button>
    </div>

    <div class="dijitHidden">
      <div
        data-dojo-type="dijit/Dialog"
        style="width: 600px; background: white"
        id="beerDialog"
        data-dojo-props="title:'See the Beer!'"
      >
        <div id="beerSelect"></div>
        <p id="value"></p>
      </div>
    </div>

    <script>
      var dojoConfig = {
        async: true,
        dojoBlankHtmlUrl:
          location.pathname.replace(/\/[^/]+$/, '') + '/blank.html',
        packages: [
          {
            name: 'widget',
            location: location.pathname.replace(/\/[^/]+$/, '') + '/widget',
          },
          {
            name: 'modules',
            location: location.pathname.replace(/\/[^/]+$/, '') + '/modules',
          },
        ],
      };
    </script>
    <script src="//ajax.googleapis.com/ajax/libs/dojo/1.8.1/dojo/dojo.js"></script>
    <script>
      require([
        'dojo/dom',
        'dojo/on',
        'dojo/dom-style',
        'dojo/parser',
        'dijit/Dialog',
        'dijit/registry',
        'dijit/form/Select',
        'dojo/store/Memory',
        'widget/WidgetTraining',
        'modules/fetchData.js',
        'dojo/domReady!',
      ], (
        dom,
        on,
        domStyle,
        parser,
        dialog,
        registry,
        Select,
        Memory,
        WidgetTraining,
        fetchData
      ) => {
        const url = 'https://api.punkapi.com/v2/beers';
        const container = dom.byId('container');
        const btn = dom.byId('btn');

        showDialog = function () {
          registry.byId('beerDialog').show();
        };

        const getBeersAndPopup = () => {
          const widget = new WidgetTraining().placeAt(container);
          fetchData.getBeers(url).then((data) => {
            const beerStore = new Memory({
              idProperty: 'tagline',
              data,
            });

            const select = new Select(
              {
                name: 'beerSelect',
                store: beerStore,
                style: 'width: 200px;',
                labelAttr: 'name',
                maxHeight: -1,
                onChange: function (value) {
                  document.getElementById('value').innerHTML = value;
                },
              },
              'beerSelect'
            );
            select.startup();

            widget.endLoading();
            showDialog();
          });
        };

        on(btn, 'click', getBeersAndPopup);

        parser.parse();
      });
    </script>
  </body>
</html>
